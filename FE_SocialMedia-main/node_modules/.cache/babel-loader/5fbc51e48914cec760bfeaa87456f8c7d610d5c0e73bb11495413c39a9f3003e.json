{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nconst initialState = {\n  posts: [],\n  comments: {},\n  loading: false,\n  error: null\n};\nconst postSlice = createSlice({\n  name: \"post\",\n  initialState,\n  reducers: {\n    //Action load bài viết\n    getPostsStart(state) {\n      state.loading = true;\n      state.error = null;\n    },\n    getPostsSuccess(state, action) {\n      console.log(\"Updating Redux state with:\", action.payload);\n      state.posts = [...action.payload]; // Gán dữ liệu mới\n      state.loading = false;\n    },\n    getPostsFailed(state, action) {\n      state.loading = false;\n      state.error = action.payload;\n    },\n    // Action thêm bài viết mới\n    addPost(state, action) {\n      state.posts.unshift(action.payload); //Thêm vào đầu mảng\n    },\n\n    // Xóa bài viết\n    deletePost(state, action) {\n      state.posts = state.posts.filter(post => post.postId != action.payload);\n    },\n    // Cập nhật bài viết\n    updatePost(state, action) {\n      const index = state.posts.findIndex(post => post.postId == action.payload);\n      if (index != -1) {\n        state.posts[index] = action.payload;\n      }\n    },\n    toggleLikeState(state, action) {\n      const {\n        postId,\n        userId\n      } = action.payload;\n      const post = state.posts.find(p => p.postId === postId);\n      if (post) {\n        const likes = post.likes || [];\n        const isLiked = likes.some(like => like.userId === userId);\n        if (isLiked) {\n          post.likes = likes.filter(like => like.userId !== userId);\n          post.likeCount -= 1;\n        } else {\n          post.likes = [...likes, {\n            userId,\n            postId\n          }];\n          post.likeCount += 1;\n        }\n      }\n    },\n    setCommentsState(state, action) {\n      const {\n        postId,\n        comments\n      } = action.payload;\n      state.comments[postId] = comments; // Lưu comments theo postId\n    },\n\n    addCommentState(state, action) {\n      const {\n        postId,\n        comment\n      } = action.payload;\n      if (!state.comments[postId]) {\n        state.comments[postId] = [];\n      }\n      state.comments[postId].unshift(comment);\n\n      // Tăng số lượng cmt\n      const post = state.posts.find(p => p.postId === postId);\n      ;\n      if (post) {\n        post.commentCount = (post.commentCount || 0) + 1;\n      }\n    }\n  }\n});\nexport const {\n  getPostsStart,\n  getPostsSuccess,\n  getPostsFailed,\n  addPost,\n  deletePost,\n  updatePost,\n  toggleLikeState,\n  addCommentState\n} = postSlice.actions;\nexport default postSlice.reducer;\n\n// export function SetPosts(post) {\n//   return (dispatch, getState) => {\n//     dispatch(postSlice.actions.getPosts(post));\n//   };\n// }","map":{"version":3,"names":["createSlice","initialState","posts","comments","loading","error","postSlice","name","reducers","getPostsStart","state","getPostsSuccess","action","console","log","payload","getPostsFailed","addPost","unshift","deletePost","filter","post","postId","updatePost","index","findIndex","toggleLikeState","userId","find","p","likes","isLiked","some","like","likeCount","setCommentsState","addCommentState","comment","commentCount","actions","reducer"],"sources":["D:/code/XDPMTMHPL/doan/FE_SocialMedia-main/src/redux/postSlice.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\n\r\nconst initialState = {\r\n  posts: [],\r\n  comments: {},\r\n  loading: false,\r\n  error: null\r\n\r\n};\r\n\r\nconst postSlice = createSlice({\r\n  name: \"post\",\r\n  initialState,\r\n  reducers: {\r\n    //Action load bài viết\r\n    getPostsStart(state) {\r\n      state.loading=true;\r\n      state.error=null;\r\n    },\r\n    getPostsSuccess(state, action){\r\n      console.log(\"Updating Redux state with:\", action.payload);\r\n      state.posts = [...action.payload]; // Gán dữ liệu mới\r\n      state.loading = false;\r\n    },\r\n    getPostsFailed(state, action){\r\n      state.loading = false;\r\n      state.error = action.payload;\r\n    },\r\n\r\n    // Action thêm bài viết mới\r\n    addPost(state, action){\r\n      state.posts.unshift(action.payload); //Thêm vào đầu mảng\r\n    },\r\n\r\n    // Xóa bài viết\r\n    deletePost(state, action){\r\n      state.posts = state.posts.filter((post)=>post.postId != action.payload);\r\n    },\r\n\r\n    // Cập nhật bài viết\r\n    updatePost(state, action){\r\n      const index = state.posts.findIndex((post)=>post.postId==action.payload);\r\n      if(index != -1){\r\n        state.posts[index] = action.payload;\r\n      }\r\n    },\r\n\r\n    toggleLikeState(state, action){\r\n      const { postId, userId } = action.payload;\r\n      const post = state.posts.find((p) => p.postId === postId);\r\n      if (post) {\r\n        const likes = post.likes || [];\r\n        const isLiked = likes.some(like => like.userId === userId);\r\n        if (isLiked) {\r\n          post.likes = likes.filter(like => like.userId !== userId);\r\n          post.likeCount -= 1;\r\n        } else {\r\n          post.likes = [...likes, { userId, postId }];\r\n          post.likeCount += 1;\r\n        }\r\n      }\r\n    },\r\n\r\n    setCommentsState(state, action){\r\n      const { postId, comments } = action.payload;\r\n      state.comments[postId] = comments; // Lưu comments theo postId\r\n    },\r\n\r\n    addCommentState(state, action){\r\n      const {postId, comment} = action.payload;\r\n      if(!state.comments[postId]){\r\n        state.comments[postId] = [];\r\n      }\r\n      state.comments[postId].unshift(comment);\r\n\r\n      // Tăng số lượng cmt\r\n      const post = state.posts.find(p => p.postId === postId);;\r\n      if(post){\r\n        post.commentCount = (post.commentCount || 0) + 1;\r\n      }\r\n    }\r\n  },\r\n});\r\n\r\nexport const{\r\n  getPostsStart, \r\n  getPostsSuccess, \r\n  getPostsFailed, \r\n  addPost,\r\n  deletePost,\r\n  updatePost, \r\n  toggleLikeState,\r\n  addCommentState,\r\n} = postSlice.actions;\r\n\r\n\r\nexport default postSlice.reducer;\r\n\r\n// export function SetPosts(post) {\r\n//   return (dispatch, getState) => {\r\n//     dispatch(postSlice.actions.getPosts(post));\r\n//   };\r\n// }\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}